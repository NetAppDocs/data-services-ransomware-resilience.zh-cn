---
sidebar: sidebar 
permalink: rp-use-recover.html 
keywords: ransomware protection recovery, recover from a ransomware attack, recovery point, RPA 
summary: '遭受攻击后， NetApp Ransomware Resilience 会验证二级存储上的备份数据是否干净，推荐实际恢复点 (RPA)，并协调防崩溃恢复的工作流程。' 
---
= 借助NetApp勒索软件恢复能力，在勒索软件攻击发生后恢复
:hardbreaks:
:allow-uri-read: 
:icons: font
:imagesdir: ./media/


[role="lead"]
在工作负载被标记为“需要恢复”后， NetApp Ransomware Resilience 会建议实际恢复点 (RPA) 并协调工作流程以实现抗崩溃恢复。

* 如果应用程序或虚拟机由SnapCenter管理，则勒索软件恢复功能会使用应用程序一致或虚拟机一致的流程将应用程序或虚拟机恢复到其先前的状态和最后的事务。应用程序或 VM 一致性恢复将任何未存储的数据（例如缓存或 I/O 操作中的数据）添加到卷中的数据中。
* 如果应用程序或虚拟机不是由SnapCenter管理，而是由NetApp Backup and Recovery 或 Ransomware Resilience 管理，则 Ransomware Resilience 会执行崩溃一致性恢复，其中会恢复同一时间点卷中的所有数据（例如，如果系统崩溃）。
+
您可以通过选择所有卷、特定卷或特定文件来恢复工作负载。




TIP: 工作负载恢复可能会影响正在运行的工作负载。您应该与适当的利益相关者协调恢复过程。

工作负载可以具有以下还原状态之一：

* *需要恢复*：需要恢复工作负载。
* *进行中*：恢复操作目前正在进行中。
* *已恢复*：工作量已恢复。
* *失败*：工作负载恢复过程无法完成。




== 查看已准备好恢复的工作负载

查看处于“需要恢复”恢复状态的工作负载。

.步骤
. 执行以下操作之一：
+
** 在仪表板中，查看警报窗格中的“需要恢复”总数，然后选择*查看全部*。
** 从菜单中选择*恢复*。


. 查看“*恢复*”页面中的工作负载信息。
+
image:screen-recovery2.png["恢复页面"]





== 还原由SnapCenter管理的工作负载

使用勒索软件恢复能力，存储管理员可以确定如何从推荐的还原点或首选的还原点最佳地恢复工作负载。

如果需要恢复，应用程序状态将会改变。如果备份中包含控制文件，应用程序将从控制文件恢复到其先前的状态。恢复完成后，应用程序将以读写模式打开。

*所需的控制台角色* 要执行此任务，您需要组织管理员、文件夹或项目管理员或勒索软件恢复管理员角色。link:https://docs.netapp.com/us-en/console-setup-admin/reference-iam-ransomware-roles.html["了解NetApp Console的勒索软件恢复角色"^] 。

.步骤
. 从勒索软件恢复中，选择*恢复*。
. 查看“*恢复*”页面中的工作负载信息。
. 选择处于“需要恢复”状态的工作负载。
. 要恢复，请选择*恢复*。
. *恢复范围*：应用程序一致（或者对于虚拟机的SnapCenter ，恢复范围为“按虚拟机”）
. *来源*：选择来源旁边的向下箭头查看详细信息。选择要用于还原数据的还原点。
+

TIP: 勒索软件恢复能力将最佳还原点识别为事件发生前的最新备份，并显示“推荐”指示。

. *目的地*：选择目的地旁边的向下箭头查看详细信息。
+
.. 选择原始位置或备用位置。
.. 选择系统。
.. 选择存储虚拟机。


. 如果原始目标没有足够的空间来恢复工作负载，则会出现“临时存储”行。您可以选择临时存储来恢复工作负载数据。恢复的数据将从临时存储复制到原始位置。单击临时存储行中的*向下箭头*并设置目标集群、存储虚拟机和本地层。
. 选择*保存*。
. 选择“下一步”。
. 检查您的选择。
. 选择*恢复*。
. 从顶部菜单中，选择“*恢复*”以查看“恢复”页面上的工作负载，其中操作的状态会在各个状态之间移动。




== 还原不受SnapCenter管理的工作负载

使用勒索软件恢复能力，存储管理员可以确定如何从推荐的还原点或首选的还原点最佳地恢复工作负载。

*所需的控制台角色* 要执行此任务，您需要组织管理员、文件夹或项目管理员或勒索软件恢复管理员角色。link:https://docs.netapp.com/us-en/console-setup-admin/reference-iam-ransomware-roles.html["了解NetApp Console的勒索软件恢复角色"^] 。

安全存储管理员可以恢复不同级别的数据：

* 恢复所有卷
* 在卷级别或文件和文件夹级别恢复应用程序。
* 在卷级别、目录或文件/文件夹级别恢复文件共享。
* 从虚拟机级别的数据存储中恢复。


该过程根据工作负载类型而有所不同。

.步骤
. 从勒索软件恢复菜单中，选择*恢复*。
. 查看“*恢复*”页面中的工作负载信息。
. 选择处于“需要恢复”状态的工作负载。
. 要恢复，请选择*恢复*。
. *恢复范围*：选择您想要完成的恢复类型：
+
** 所有卷
** 按体积
** 按文件：您可以指定要还原的文件夹或单个文件。
+

IMPORTANT: 对于 SAN 工作负载，您只能按工作负载进行恢复。

+

TIP: 您最多可以选择 100 个文件或一个文件夹。



. 根据您选择的是应用程序、卷还是文件，继续执行以下步骤之一。




=== 恢复所有卷

. 从勒索软件恢复菜单中，选择*恢复*。
. 选择处于“需要恢复”状态的工作负载。
. 要恢复，请选择*恢复*。
. 在“还原”页面的“还原范围”中，选择“*所有卷*”。
+
image:screen-recovery-all-volumes.png["按所有卷恢复页面"]

. *来源*：选择来源旁边的向下箭头查看详细信息。
+
.. 选择要用于还原数据的还原点。
+

TIP: 勒索软件恢复能力将最佳还原点识别为事件发生前的最新备份，并显示“对所有卷最安全”的指示。这意味着所有卷都将恢复到检测到的第一个卷受到第一次攻击之前的副本。



. *目的地*：选择目的地旁边的向下箭头查看详细信息。
+
.. 选择系统。
.. 选择存储虚拟机。
.. 选择聚合。
.. 更改将添加到所有新卷的卷前缀。
+

TIP: 新卷名称显示为前缀+原始卷名称+备份名称+备份日期。



. 选择*保存*。
. 选择“下一步”。
. 检查您的选择。
. 选择*恢复*。
. 从顶部菜单中，选择“*恢复*”以查看“恢复”页面上的工作负载，其中操作的状态会在各个状态之间移动。




=== 在卷级别恢复应用程序工作负载

. 从勒索软件恢复菜单中，选择*恢复*。
. 选择处于“需要恢复”状态的应用程序工作负载。
. 要恢复，请选择*恢复*。
. 在“还原”页面的“还原范围”中，选择“按卷”。
+
image:screen-recovery-byvolume.png["按卷恢复页面"]

. 在卷列表中，选择要还原的卷。
. *来源*：选择来源旁边的向下箭头查看详细信息。
+
.. 选择要用于还原数据的还原点。
+

TIP: 勒索软件恢复能力将最佳还原点识别为事件发生前的最新备份，并显示“推荐”指示。



. *目的地*：选择目的地旁边的向下箭头查看详细信息。
+
.. 选择系统。
.. 选择存储虚拟机。
.. 选择聚合。
.. 查看新的卷名称。
+

TIP: 新的卷名称显示为原始卷名称+备份名称+备份日期。



. 选择*保存*。
. 选择“下一步”。
. 检查您的选择。
. 选择*恢复*。
. 从顶部菜单中，选择“*恢复*”以查看“恢复”页面上的工作负载，其中操作的状态会在各个状态之间移动。




=== 在文件级别恢复应用程序工作负载

在文件级别恢复应用程序工作负载之前，您可以查看受影响文件的列表。您可以访问警报页面下载受影响文件的列表。然后使用恢复页面上传列表并选择要恢复的文件。

您可以将文件级别的应用程序工作负载还原到相同或不同的系统。

.获取受影响文件列表的步骤
使用“警报”页面检索受影响文件的列表。


TIP: 如果某个卷有多个警报，您将需要下载每个警报的受影响文件的 CSV 列表。

. 从勒索软件恢复菜单中，选择*警报*。
. 在“警报”页面上，按工作负载对结果进行排序，以显示要恢复的应用程序工作负载的警报。
. 从该工作负载的警报列表中选择一个警报。
. 对于该警报，选择一个事件。
+
image:screen-alerts-incidents-impacted-files.png["特定警报的受影响文件列表"]

. 要查看完整的文件列表，请选择“受影响的文件”窗格顶部的“*单击此处*”。
. 对于该事件，选择下载图标并以 CSV 格式下载受影响文件的列表。


.恢复这些文件的步骤
. 从勒索软件恢复菜单中，选择*恢复*。
. 选择处于“需要恢复”状态的应用程序工作负载。
. 要恢复，请选择*恢复*。
. 在“还原”页面的“还原范围”中，选择“按文件”。
. 在卷列表中，选择包含要还原的文件的卷。
. *还原点*：选择*还原点*旁边的向下箭头查看详细信息。选择要用于还原数据的还原点。
+

NOTE: 还原点窗格中的“原因”列显示快照或备份的原因为“计划”或“对勒索软件事件的自动响应”。

. *文件*：
+
** *自动选择文件*：让勒索软件恢复功能选择要恢复的文件。
** *上传文件列表*：上传一个 CSV 文件，其中包含您从警报页面获取的或您拥有的受影响文件的列表。您一次最多可以恢复 10,000 个文件。
+
image:screen-recovery-app-by-file-upload-csv.png["上传列出警报受影响文件的 CSV 文件"]

** *手动选择文件*：选择最多 10,000 个文件或单个文件夹进行恢复。
+
image:screen-recovery-app-by-file-select-files.png["手动选择要恢复的文件"]

+

NOTE: 如果无法使用所选还原点还原任何文件，则会出现一条消息，指示无法还原的文件数量，并允许您通过选择“下载受影响文件的列表”来下载这些文件的列表。



. *目的地*：选择目的地旁边的向下箭头查看详细信息。
+
.. 选择恢复数据的位置：原始源位置或您可以指定的备用位置。
+

TIP: 虽然原始文件或目录将被恢复的数据覆盖，但原始文件和文件夹名称将保持不变，除非您指定新名称。

.. 选择系统。
.. 选择存储虚拟机。
.. （可选）输入路径。
+

TIP: 如果您没有指定还原路径，文件将被还原到顶级目录的新卷。

.. 选择是否希望恢复的文件或目录的名称与当前位置的名称相同或不同。


. 选择“下一步”。
. 检查您的选择。
. 选择*恢复*。
. 从顶部菜单中，选择“*恢复*”以查看“恢复”页面上的工作负载，其中操作的状态会在各个状态之间移动。




=== 恢复文件共享或数据存储

. 选择要还原的文件共享或数据存储后，在“还原”页面的“还原范围”中，选择“按卷”。
+
image:screen-recovery-fileshare.png["显示文件共享恢复的恢复页面"]

. 在卷列表中，选择要还原的卷。
. *来源*：选择来源旁边的向下箭头查看详细信息。
+
.. 选择要用于还原数据的还原点。
+

TIP: 勒索软件恢复能力将最佳还原点识别为事件发生前的最新备份，并显示“推荐”指示。



. *目的地*：选择目的地旁边的向下箭头查看详细信息。
+
.. 选择恢复数据的位置：原始源位置或您可以指定的备用位置。
+

TIP: 虽然原始文件或目录将被恢复的数据覆盖，但原始文件和文件夹名称将保持不变，除非您指定新名称。

.. 选择系统。
.. 选择存储虚拟机。
.. （可选）输入路径。
+

TIP: 如果您没有指定还原路径，文件将被还原到顶级目录的新卷。



. 选择*保存*。
. 检查您的选择。
. 选择*恢复*。
. 从菜单中，选择“*恢复*”以查看“恢复”页面上的工作负载，其中操作的状态在各个状态之间移动。




=== 在 VM 级别还原 VM 文件共享

在选择要还原的虚拟机后，在“恢复”页面上继续执行以下步骤。

. *来源*：选择来源旁边的向下箭头查看详细信息。
+
image:screen-recovery-vm.png["恢复页面显示正在恢复的虚拟机"]

. 选择要用于还原数据的还原点。
. *目的地*：返回原始位置。
. 选择“下一步”。
. 检查您的选择。
. 选择*恢复*。
. 从菜单中，选择“*恢复*”以查看“恢复”页面上的工作负载，其中操作的状态在各个状态之间移动。

